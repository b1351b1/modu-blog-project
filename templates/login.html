<!DOCTYPE html>
<html lang="ko-KR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로그인 - 영어교육용 블로그</title>
  <link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="/static/css/login-join.css">
</head>

<body>
  <!-- header -->
  <div class="header">
    <h1><a href="/templates/intro.html">영어교육용 블로그</a></h1>
    <div class="header-click">
      <a href="/templates/login.html">로그인</a>
      <a href="/templates/join.html">회원가입</a>
      <button type="button" id="logout-btn" style="display: none;">로그아웃</button>
    </div>
  </div>
  <!-- // header -->

  <div class="main">
    <div class="container">
      <h2 class="title">로그인</h2>
      <p class="description">아이디와 비밀번호를 입력하고 로그인하세요</p>

      <form class="login">
        <div>
          <label class="label-width" for="user-id">아이디</label>
          <input type="text" id="user-id" name="userId" required>
        </div>
        <div>
          <label class="label-width" for="user-pw">비밀번호</label>
          <input type="password" id="user-pw" name="userPw" required>
        </div>
        <button class="submit-button" type="submit">로그인</button>
      </form>
    </div>
  </div>

  <!-- footer -->
  <p class="footer">Copyright 2025. 영어교육용 블로그 All rights reserved.</p>
  <!-- //footer -->

  <script>
    const API_BASE_URL = 'http://localhost:8000';
    
    document.querySelector('.login').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const name = document.getElementById('user-id').value;
      const password = document.getElementById('user-pw').value;
      
      
      try {
        const response = await fetch(`${API_BASE_URL}/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          // 토큰 및 사용자 정보 저장
          localStorage.setItem('access_token', data.access_token);
          localStorage.setItem('user_role', data.user.role);
          localStorage.setItem('user_name', data.user.name);
          localStorage.setItem('user_nickname', data.user.nickname);
          
          alert('로그인 성공!');
          window.location.href = 'intro.html';
        } else {
          alert('로그인 실패: ' + data.detail);
        }
      } catch (error) {
        alert('로그인 중 오류가 발생했습니다.');
        console.error(error);
      }
    });
  </script>
</body>

</html>