<!DOCTYPE html>
<html lang="ko-KR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¸ê¸°ë¬¸ì œ Top 10 - ì˜ì–´êµìœ¡ìš© ë¸”ë¡œê·¸</title>
  <link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="/static/css/problems.css">
</head>

<body>
  <!-- header -->
  <div class="header">
    <h1><a href="/">ì˜ì–´êµìœ¡ìš© ë¸”ë¡œê·¸</a></h1>
    <div class="header-click">
      <span id="user-nickname" style="margin-right: 10px; font-weight: 600;"></span>
      <a href="/templates/index.html">ê²Œì‹œíŒ</a>
      <a href="/templates/problem-register.html">ë¬¸ì œë“±ë¡</a>
      <a href="/templates/popular-problems.html" id="popular-link" style="display: none;">ì¸ê¸°ë¬¸ì œ</a>
      <button type="button" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <div class="main">
    <h2 class="main-title">ğŸ“Š ì¸ê¸°ë¬¸ì œ Top 10</h2>
    <p class="main-desc">ê°€ì¥ ë§ì´ ì„ íƒëœ ë¬¸ì œë¥¼ í™•ì¸í•˜ì„¸ìš” (ê´€ë¦¬ì ì „ìš©)</p>

    <!-- ë¡œë”© -->
    <div id="loading" style="text-align: center; padding: 60px 20px;">
      <p style="color: #999;">ì¸ê¸°ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- ì¸ê¸°ë¬¸ì œ ëª©ë¡ -->
    <div class="popular-container" id="popular-container" style="display: none;">
      <div class="popular-list" id="popular-list">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
      </div>
    </div>

    <!-- ë¹ˆ ìƒíƒœ -->
    <div class="empty-state" id="empty-state" style="display: none;">
      <div class="empty-icon">ğŸ“­</div>
      <h3 class="empty-title">ì•„ì§ ì„ íƒëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
      <p class="empty-desc">
        ì‚¬ìš©ìë“¤ì´ ë¬¸ì œë¥¼ ì„ íƒí•˜ë©´ ì—¬ê¸°ì— ì¸ê¸°ë¬¸ì œê°€ í‘œì‹œë©ë‹ˆë‹¤.
      </p>
    </div>
  </div>

  <!-- footer -->
  <p class="footer">Copyright 2025. ì˜ì–´êµìœ¡ìš© ë¸”ë¡œê·¸ All rights reserved.</p>
  <!-- //footer -->

  <script>
    const API_BASE_URL = 'http://localhost:8000';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ë° ì¸ê¸°ë¬¸ì œ ë¡œë“œ
    window.addEventListener('DOMContentLoaded', function() {
      checkAdminAndLoadPopular();
    });

    // ê´€ë¦¬ì í™•ì¸ ë° ì¸ê¸°ë¬¸ì œ ë¡œë“œ
    async function checkAdminAndLoadPopular() {
      const token = localStorage.getItem('access_token');
      const userRole = localStorage.getItem('user_role');
      const userNickname = localStorage.getItem('user_nickname');
      
      if (!token) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = 'login.html';
        return;
      }
      
      if (userRole !== 'admin') {
        alert('ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        window.location.href = 'index.html';
        return;
      }

      // ë‹‰ë„¤ì„ í‘œì‹œ
      if (userNickname) {
        document.getElementById('user-nickname').textContent = `${userNickname}ë‹˜`;
      }
      
      // ì¸ê¸°ë¬¸ì œ ë¡œë“œ
      await loadPopularProblems();
    }

    // ì¸ê¸°ë¬¸ì œ ë¡œë“œ
    async function loadPopularProblems() {
      try {
        const response = await fetch(`${API_BASE_URL}/problems/popular`);
        const data = await response.json();
        
        // ë¡œë”© ìˆ¨ê¸°ê¸°
        document.getElementById('loading').style.display = 'none';
        
        if (response.ok && data.popular_problems && data.popular_problems.length > 0) {
          displayPopularProblems(data.popular_problems);
          document.getElementById('popular-container').style.display = 'block';
        } else {
          document.getElementById('empty-state').style.display = 'block';
        }
      } catch (error) {
        console.error('ì¸ê¸°ë¬¸ì œ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('empty-state').style.display = 'block';
      }
    }

    // ì¸ê¸°ë¬¸ì œ í‘œì‹œ
    function displayPopularProblems(problems) {
      const listContainer = document.getElementById('popular-list');
      
      const html = problems.map((item, index) => {
        const rank = index + 1;
        const rankClass = rank <= 3 ? 'rank-top' : '';
        const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : '';
        const difficultyStars = getDifficultyStars(item.difficulty);
        
        return `
          <div class="popular-card ${rankClass}">
            <div class="popular-rank">
              <span class="rank-number">${rankEmoji || rank}</span>
            </div>
            <div class="popular-info">
              <div class="popular-header">
                <div class="problem-badge">
                  <span>${item.year}ë…„ ${item.month}ì›”</span>
                  <span>${item.number}ë²ˆ</span>
                </div>
                <div class="problem-difficulty">
                  <span class="difficulty-stars">${difficultyStars}</span>
                  <span class="difficulty-text">${item.difficulty}</span>
                </div>
              </div>
              <h3 class="popular-title">${item.title}</h3>
              <div class="popular-stats">
                <div class="stat-item">
                  <span class="stat-icon">ğŸ”¥</span>
                  <span class="stat-label">ì„ íƒ íšŸìˆ˜:</span>
                  <span class="stat-value">${item.selection_count}íšŒ</span>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      listContainer.innerHTML = html;
    }

    // ë‚œì´ë„ì— ë”°ë¥¸ ë³„ ê°œìˆ˜ ë°˜í™˜
    function getDifficultyStars(difficulty) {
      const starMap = {
        'ìƒ': 'â­â­â­',
        'ì¤‘': 'â­â­',
        'í•˜': 'â­'
      };
      return starMap[difficulty] || 'â­â­';
    }

    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById('logout-btn').addEventListener('click', function() {
      localStorage.removeItem('access_token');
      localStorage.removeItem('user_role');
      localStorage.removeItem('user_name');
      localStorage.removeItem('user_nickname');
      window.location.href = 'intro.html';
    });
  </script>
</body>

</html>